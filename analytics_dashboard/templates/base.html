{% comment %}
Base template pages.
{% endcomment %}

{% load dashboard_extras %}
{% load get_files from webpack_loader %}
{% load render_bundle from webpack_loader %}

<!DOCTYPE html>
<!--[if lte IE 9]><html class="no-js lt-ie10" lang="en"><![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="shortcut icon" type="image/png" href="{{STATIC_URL}}/images/favicon.ico"/>

    <title>{% block title %}| {% settings_value 'FULL_APPLICATION_NAME' %}{% endblock title %}</title>

    {% comment %}
    The stylesheets can be either overriden or augmented here.  Make sure to use the block.super if you're
    adding additional stylesheets in your page when extending the base.
    {% endcomment %}

	  {% get_files 'application-main' 'css' as common_css %}
    {% for css_file in common_css %}
        <link rel="stylesheet" href="{{ css_file.publicPath }}" type="text/css">
    {% endfor %}

    <link rel="stylesheet" href="{% settings_value 'LMS_HOST_URL' %}/static/groove-theme/css/insights.css" type="text/css">

    <script type="text/javascript" src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.16/css/bootstrap-multiselect.min.css" type="text/css" media="all" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.16/js/bootstrap-multiselect.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>

    {% block stylesheets %}
    {% endblock %}

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

</head>

{% block body %}{% endblock %}

{% block javascript %}
  {# webpack loading #}
  {% render_bundle 'manifest' %}
  {% render_bundle 'globalization' %}
  {% render_bundle 'application-main' %}
{% endblock javascript %}

{% include 'svgIcon.html' %}


<script type="text/javascript">
  if (typeof $.fn.multiselect === 'undefined') {
    var node = document.createElement("script");
    node.setAttribute("type", "text/javascript");
    node.setAttribute("src", "//cdnjs.cloudflare.com/ajax/libs/bootstrap-multiselect/0.9.16/js/bootstrap-multiselect.min.js");

    var heads = document.getElementsByTagName('head');
    if (heads && heads.length) {
      var headTag = heads[0];
      if (headTag) {
          headTag.insertBefore(node, document.getElementById('bootstrap-multiselect'));
      }
    }
  }
  
  function initMultiSelect(el) {
    // return;
    setTimeout(() => {
      el = el || $('select');
      if (typeof $.fn.multiselect === 'function') {
        el.multiselect({
          buttonTextAlignment: 'left',
          includeSelectAllOption: true,
          maxHeight: 300,
          onChange: function(option, checked, select) {
            var selectElem = option.closest('.multiselect-native-select')[0].querySelectorAll('select')[0];
            var changeEvent = new Event('change');
            var blurEvent = new Event('blur');
            selectElem.dispatchEvent(changeEvent);
            selectElem.dispatchEvent(blurEvent);
          }
        });
      } 
    });
  }

  $(document).ready(function() {
    initMultiSelect();
    $("body").bind("DOMSubtreeModified", function(e, b) {
      var el = $(e.target);
      if (el.is("option") || el.is("optgroup")) {
        var currentSelect = el.parent();
        if (currentSelect.is("select")) {
          if (!currentSelect.data('multiselect')) {
            initMultiSelect(currentSelect);
          }
        }
      }
      
      $(e.target).find("select").each(function() {
          if (!$(this).data('multiselect')) {
            initMultiSelect($(this));
          }
      });
    });
  });
</script>
</html>
